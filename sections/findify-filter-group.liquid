{% liquid
  assign page_url = content_for_header | split: '"pageurl":"' | last | split: '"' | first | split: request.host | last | replace: "\/", "/" | replace: "\u0026", "&" | replace: '%7C', '|' | replace: '%20', ' '
  assign query_parameters = page_url | split: "sections=findify-filter-group&" | last

  assign filters_parameters = query_parameters | split: "filters=" | last | split: '&' | first | split: '='
  assign filters_props = filters_parameters | first | split: '~'
  assign name = filters_props[0] | url_decode
  assign group_label = filters_props[1] | url_decode
  assign type = filters_props[2]
  assign filters = filters_parameters | last | split: '|'

  assign color_filter_layout = query_parameters | split: "color_filter=" | last | split: '&' | first

  assign component = type
  if name == 'category'
    assign component = 'text'
  endif
  if name contains 'reviews'
    assign component = 'reviews'
  endif
  if name == 'color'
    assign component = 'color'
  endif

  assign element_id = 'findify-filters-' | append: name
%}

<div id="{{ element_id }}" class="findify-filter-group">
  <div class="findify-filters-header">
    <label tabindex="-1">
      {{ group_label }}
    </label>
    {% render 'findify-icon-arrow' %}
  </div>
  <div class="findify-filters-body" aria-expanded="true">
    {% case component %}
      {% when 'text' %}
        {% render 'findify-filter-text'
          , name: name
          , type: type
          , component: component
          , filters: filters %}
      {% when 'color' %}
        {% render 'findify-filter-color'
          , name: name
          , type: type
          , component: component
          , filters: filters
          , color_filter_layout: color_filter_layout %}
      {% when 'range' or 'reviews' %}
        {% render 'findify-filter-range'
          , name: name
          , type: type
          , component: component
          , filters: filters %}
    {% endcase %}
  </div>

</div>

<script>
  const element_id = "{{ element_id }}";
  
  const collapseFilter = () => {
    const filter = document.getElementById(element_id)
    const childrens = filter.querySelectorAll('div');
    const header = childrens[0];
    const body = childrens[1];

    header.addEventListener("click", (e) => {
      e.preventDefault();
      const isOpen = body.getAttribute("aria-expanded") === "true";
      body.setAttribute("aria-expanded", (!isOpen).toString());
    });
  };
  collapseFilter();
</script>